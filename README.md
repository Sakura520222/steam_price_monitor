# Steam Price Monitor - Steam价格监控插件

## 访问统计
![访问统计](https://count.getloli.com/get/@steam_price_monitor?theme=rule34)

## 简介

Steam Price Monitor 是一款专业的Steam游戏价格监控插件，基于AstrBot框架开发。支持查询国区价格、史低信息、多区服价格对比和自动价格监控功能。支持自动识别游戏名或Steam商店链接，为Steam玩家提供全方位的价格信息服务。

## 主要特性

### 🔍 智能搜索功能
- **多语言支持**：支持中文、英文游戏名搜索
- **智能翻译**：自动翻译中文游戏名为Steam官方英文名
- **链接识别**：自动识别Steam商店链接并提取AppID
- **多源搜索**：结合ITAD API和Steam官方API进行搜索

### 💰 价格查询功能
- **国区价格**：查询中国区实时价格和折扣信息
- **史低信息**：获取游戏历史最低价格和折扣记录
- **多区对比**：支持UA、US、JP、KR、RU、CN、TR等区服价格对比
- **汇率转换**：自动将外币价格转换为人民币进行对比

### 🔔 价格监控功能
- **自动监控**：定时检查订阅游戏的价格变动
- **智能通知**：价格变动时自动发送详细通知
- **多状态提醒**：支持价格上涨、下跌、免费等状态提醒
- **个性化订阅**：每个用户可独立管理自己的监控列表

### ⚙️ 配置管理
- **灵活配置**：支持启用/禁用价格监控功能
- **自定义间隔**：可设置价格监控检查间隔（30-60分钟）
- **API密钥管理**：支持ITAD API和Steam Web API配置
- **数据持久化**：自动保存监控列表和配置信息

## 快速开始

### 1. 安装插件

将插件目录放入 AstrBot 的插件目录：
```
AstrBot/data/plugins/steam_price_monitor/
```

### 2. 配置API密钥

在AstrBot后台管理界面中配置以下API密钥：

- **ITAD_API_KEY**：在 [isthereanydeal.com/apps/](https://isthereanydeal.com/apps/) 获取
- **STEAMWEBAPI_KEY**：在 [steamcommunity.com/dev/apikey](https://steamcommunity.com/dev/apikey) 获取

### 3. 配置插件选项

- **STEAM_COMPARE_REGION**：选择价格对比区（NONE/UA/US/JP/KR/RU/CN/TR）
- **ENABLE_PRICE_MONITOR**：启用/禁用价格监控功能
- **PRICE_MONITOR_INTERVAL**：价格监控检查间隔（分钟）

## 使用指南

### 基础查询命令

#### 1. 查询游戏价格和史低信息
```
/史低 <游戏名或Steam商店链接>
```
**别名：** `/价格`

**示例：**
- `/史低 Cyberpunk 2077`
- `/史低 https://store.steampowered.com/app/1091500`
- `/史低 赛博朋克2077`

**功能：**
- 查询游戏当前价格和折扣信息
- 显示历史最低价格记录
- 支持多区服价格对比
- 自动汇率转换

#### 2. 搜索Steam游戏
```
/查找游戏 <游戏名>
```
**功能：**
- 搜索Steam游戏库
- 返回匹配的游戏列表
- 支持模糊搜索

### 价格监控命令

#### 1. 订阅价格监控
```
/价格监控 <游戏名或AppID>
```
**别名：** `/订阅价格`、`/监控价格`

**示例：**
- `/价格监控 Cyberpunk 2077`
- `/价格监控 1091500`
- `/价格监控 千恋万花`

**功能：**
- 订阅游戏价格监控
- 支持中文游戏名自动翻译
- 订阅成功后开始定期监控

#### 2. 取消价格监控
```
/取消监控 <游戏名或AppID>
```
**别名：** `/取消订阅`、`/停止监控`

**示例：**
- `/取消监控 Cyberpunk 2077`
- `/取消监控 1091500`

**功能：**
- 取消对指定游戏的价格监控
- 支持通过游戏名或AppID取消

#### 3. 查看监控列表
```
/监控列表
```
**功能：**
- 查看当前用户订阅的所有监控游戏
- 显示游戏名称和当前记录的价格

### 价格变动通知

当监控的游戏价格发生变化时，插件会自动发送通知：

#### 通知类型
- 🎉 **游戏免费**：游戏变为免费时通知
- ⬆️ **价格上涨**：价格上涨时通知
- ⬇️ **价格下跌**：价格下跌时通知

#### 通知内容
- 游戏名称和价格变动信息
- 变动前后价格对比
- 当前折扣信息
- Steam商店链接

#### 通知示例
```
⬇️ 游戏《Cyberpunk 2077》价格下跌：¥-149.00
变动前价格：¥298.00
当前价格：¥149.00
原价：¥298.00
折扣：50%
购买链接：https://store.steampowered.com/app/1091500
```

## 技术架构

### API集成
- **ITAD API**：用于获取游戏信息和史低数据
- **Steam Web API**：用于获取实时价格信息
- **Steam商店API**：用于游戏搜索和价格查询

### 数据处理
- **异步处理**：使用asyncio进行异步API调用
- **定时任务**：基于APScheduler实现定时监控
- **数据存储**：JSON格式存储监控配置
- **线程安全**：使用锁机制保证数据一致性

### 错误处理
- **重试机制**：API调用失败时自动重试
- **降级策略**：主API失败时使用备用API
- **异常捕获**：完善的异常处理和日志记录

## 配置说明

### 配置文件结构

插件配置保存在 `_conf_schema.json` 中，包含以下选项：

```json
{
  "ITAD_API_KEY": "ITAD API密钥",
  "STEAMWEBAPI_KEY": "Steam Web API密钥", 
  "STEAM_COMPARE_REGION": "价格对比区（NONE/UA/US/JP/KR/RU/CN/TR）",
  "PRICE_MONITOR_INTERVAL": "监控间隔（分钟）",
  "ENABLE_PRICE_MONITOR": "启用价格监控"
}
```

### 数据文件结构

监控列表保存在 `data/steam_price_monitor/price_monitor_list.json`：

```json
{
  "user_id": {
    "appid": {
      "game_name": "游戏名称",
      "last_price": 149.00,
      "last_check": "2024-01-01 12:00:00"
    }
  }
}
```

## 故障排除

### 常见问题

#### Q: 为什么收不到价格变动通知？
A: 请检查以下设置：
- 插件是否已正确配置API密钥
- 网络连接是否正常
- 监控间隔设置是否合理
- 游戏是否在中国区有价格信息

#### Q: 游戏名搜索失败怎么办？
A: 尝试以下方法：
- 使用Steam商店链接直接查询
- 检查游戏名拼写是否正确
- 确保AstrBot设置了默认大模型用于翻译

#### Q: 如何完全禁用价格监控功能？
A: 在插件配置中将 `ENABLE_PRICE_MONITOR` 设置为 false

#### Q: 汇率转换不准确怎么办？
A: 编辑 `price_convert.py` 文件更新汇率数据

### 错误代码说明

- **API密钥错误**：检查ITAD和Steam API密钥配置
- **网络连接失败**：检查网络连接和防火墙设置
- **游戏未找到**：确认游戏名或链接正确，游戏在中国区可用
- **翻译失败**：检查AstrBot大模型配置

## 版本信息

- **当前版本**：2.0.0
- **框架要求**：AstrBot
- **Python版本**：3.8+
- **依赖包**：httpx, beautifulsoup4, apscheduler

### 更新日志

#### v2.0.0 (最新)
- 新增价格监控功能
- 支持多用户独立监控列表
- 优化搜索算法和错误处理
- 改进通知格式和内容

#### v1.0.0
- 基础价格查询功能
- 史低信息查询
- 多区服价格对比
- 汇率转换功能

## 开发者信息

- **作者**：车厘子小樱
- **GitHub**：https://github.com/Sakura520222
- **插件仓库**：https://github.com/Sakura520222/steam_price_monitor

## 支持与反馈

如果您在使用过程中遇到问题或有改进建议，欢迎：

1. 在GitHub仓库提交Issue
2. 加入QQ群：922321912 进行交流
3. 查看详细的使用说明文档

## 许可证

本项目采用MIT许可证，详情请查看LICENSE文件。

---

**温馨提示**：请合理使用API调用，遵守Steam和ITAD的服务条款。价格信息仅供参考，实际价格以Steam商店为准。
